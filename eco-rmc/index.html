<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USA Weekly KPI Report - Data Entry</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 8px; }
        .main-container { display: flex; gap: 10px; }
        .form-container { width: 280px; background: white; }
        .chart-container { flex: 1; background: white; }
        canvas { max-width: 100% !important; max-height: 100% !important; }
    </style>
</head>
<body>
    <h1>USA Weekly KPI Report - Data Entry</h1>
    <div class="main-container">
        <div class="form-container">
            <form id="kpi-form">
                <select id="whichWeek">
                    <option value="this">This Week</option>
                    <option value="last">Last Week</option>
                </select>
                <input type="number" id="condmon" min="0" required value="10">
                <input type="number" id="dpmon" min="0" required value="62">
                <input type="number" id="catsupport" min="0" required value="2">
                <input type="number" id="hvacsupport" min="0" required value="0">
                <input type="number" id="samsara" min="0" required value="5">
                <input type="number" id="rca" min="0" required value="0">
                <input type="number" id="remotesupport" min="0" required value="0">
                <input type="number" id="remoteaccess" min="0" required value="0">
                <input type="number" id="onsitesupport" min="0" required value="0">
                <input type="number" id="valuecases" min="0" required value="0">
                <button type="submit">Update Chart</button>
                <div id="statusMessage"></div>
            </form>
        </div>
        <div class="chart-container">
            <h2 id="chartTitle">This Week's KPI Data</h2>
            <canvas id="kpiChart"></canvas>
        </div>
    </div>

    <script>
        const storedLastWeek = localStorage.getItem('lastWeekData');
        const storedThisWeek = localStorage.getItem('thisWeekData');
        const lastWeekData = storedLastWeek ? JSON.parse(storedLastWeek) : {
            'CONDITION MONITORING': 31,
            'DP MONITORING': 224,
            'CAT SUPPORT': 24,
            'HVAC SUPPORT': 2,
            'SAMSARA MONITORING': 40,
            'RCA INVESTIGATIONS (IN HOURS)': 1,
            'REMOTE SUPPORT': 7,
            'REMOTE ACCESS': 3,
            'ON-SITE SUPPORT': 0,
            'VALUE CASES': 10
        };
        const thisWeekData = storedThisWeek ? JSON.parse(storedThisWeek) : {
            'CONDITION MONITORING': 10,
            'DP MONITORING': 62,
            'CAT SUPPORT': 2,
            'HVAC SUPPORT': 0,
            'SAMSARA MONITORING': 5,
            'RCA INVESTIGATIONS (IN HOURS)': 0,
            'REMOTE SUPPORT': 0,
            'REMOTE ACCESS': 0,
            'ON-SITE SUPPORT': 0,
            'VALUE CASES': 0
        };
        let selectedWeek = 'this';
        let currentData = { ...thisWeekData };

        const ctx = document.getElementById('kpiChart').getContext('2d');
        const kpiChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(currentData),
                datasets: [{ label: 'KPI Value', data: Object.values(currentData), backgroundColor: '#255190' }]
            },
            options: { indexAxis: 'y', responsive: true }
        };
        const fieldMapping = {
            'condmon': 'CONDITION MONITORING', 'dpmon': 'DP MONITORING', 'catsupport': 'CAT SUPPORT',
            'hvacsupport': 'HVAC SUPPORT', 'samsara': 'SAMSARA MONITORING', 'rca': 'RCA INVESTIGATIONS (IN HOURS)',
            'remotesupport': 'REMOTE SUPPORT', 'remoteaccess': 'REMOTE ACCESS',
            'onsitesupport': 'ON-SITE SUPPORT', 'valuecases': 'VALUE CASES'
        };
        function populateForm() {
            for (const [fieldId, dataKey] of Object.entries(fieldMapping)) {
                document.getElementById(fieldId).value = currentData[dataKey];
            }
        }
        function updateChart() {
            kpiChart.data.datasets[0].data = Object.values(currentData);
            kpiChart.update();
        }
        function updateTitle() {
            document.getElementById('chartTitle').textContent =
                selectedWeek === 'this' ? "This Week's KPI Data" : "Last Week's KPI Data";
        }
        function showStatus(message) {
            const msg = document.getElementById('statusMessage');
            msg.textContent = message;
            setTimeout(() => { msg.textContent = ''; }, 2000);
        }
        document.getElementById('whichWeek').addEventListener('change', function () {
            selectedWeek = this.value;
            currentData = selectedWeek === 'this' ? { ...thisWeekData } : { ...lastWeekData };
            populateForm();
            updateChart();
